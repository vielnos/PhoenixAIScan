<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhoenixAIScan â€¢ Scan Before You Burn</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root {
      --bg: #0a0a0f;
      --card: #111827;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --fire-red: #ff4d4d;
      --fire-orange: #ff8a3d;
      --fire-yellow: #ffb703;
      --safe: #22c55e;
      --medium: #f59e0b;
      --high: #ef4444;
      --critical: #dc2626;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Inter", system-ui, sans-serif;
      background: radial-gradient(ellipse at top, #0f172a 0%, var(--bg) 50%, #000000 100%);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Burning Ember Animation */
    .ember {
      position: fixed;
      width: 4px;
      height: 4px;
      background: var(--fire-orange);
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
      animation: float-up 10s infinite;
      box-shadow: 0 0 10px var(--fire-orange), 0 0 20px var(--fire-red);
      z-index: 0;
    }

    @keyframes float-up {
      0% {
        transform: translateY(100vh) translateX(0) scale(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 0.8;
      }
      100% {
        transform: translateY(-100vh) translateX(100px) scale(1.5);
        opacity: 0;
      }
    }

    /* Background Glows */
    .bg-glow {
      position: fixed;
      width: 500px;
      height: 500px;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
    }

    .bg-glow-red {
      background: var(--fire-red);
      top: -200px;
      left: -100px;
      animation: float 8s ease-in-out infinite;
    }

    .bg-glow-orange {
      background: var(--fire-orange);
      bottom: -200px;
      right: -100px;
      animation: float 8s ease-in-out infinite reverse;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(30px, -30px) scale(1.1); }
    }

    /* Layout */
    .app {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
      z-index: 10;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 48px;
    }

    .logo {
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .logo-icon {
      color: var(--fire-orange);
      filter: drop-shadow(0 0 20px rgba(255, 138, 61, 0.6));
      animation: flicker 3s ease-in-out infinite;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.9; transform: scale(1.05); }
    }

    .logo span { color: var(--fire-orange); }

    .tagline {
      font-size: 0.9rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* Glass Card */
    .glass-card {
      background: rgba(17, 24, 39, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 32px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    /* Form Grid */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 640px) {
      .form-grid { grid-template-columns: 1fr; }
    }

    .field { margin-bottom: 4px; }

    .field-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 12px;
    }

    /* Custom Select */
    .custom-select {
      position: relative;
    }

    select {
      width: 100%;
      background: rgba(2, 6, 23, 0.8);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 14px 40px 14px 16px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      outline: none;
      transition: all 0.3s;
      appearance: none;
    }

    select:hover, select:focus {
      border-color: var(--fire-orange);
      box-shadow: 0 0 0 3px rgba(255, 138, 61, 0.1);
    }

    .select-arrow {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--fire-orange);
      pointer-events: none;
    }

    /* Security Meter */
    .security-meter {
      width: 100%;
    }

    .meter-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 8px;
      position: relative;
    }

    .meter-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--fire-orange), var(--fire-red));
      width: 0%;
      transition: width 0.6s ease;
      border-radius: 3px;
    }

    .meter-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 8px;
    }

    .meter-value {
      color: var(--fire-orange);
      font-weight: 600;
    }

    /* Code Input Area */
    .code-container {
      position: relative;
      margin-bottom: 24px;
    }

    textarea {
      width: 100%;
      background: rgba(2, 6, 23, 0.9);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 20px;
      font-family: "JetBrains Mono", monospace;
      font-size: 0.95rem;
      line-height: 1.6;
      min-height: 280px;
      resize: vertical;
      outline: none;
      transition: all 0.3s;
    }

    textarea:focus {
      border-color: var(--fire-orange);
      box-shadow: 0 0 0 3px rgba(255, 138, 61, 0.1), inset 0 0 20px rgba(255, 138, 61, 0.05);
    }

    .code-actions {
      position: absolute;
      bottom: 16px;
      right: 16px;
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--muted);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .icon-btn:hover {
      background: rgba(255, 138, 61, 0.1);
      border-color: var(--fire-orange);
      color: var(--fire-orange);
      transform: translateY(-2px);
    }

    /* File Drop Zone */
    .file-zone {
      border: 2px dashed rgba(255, 138, 61, 0.3);
      border-radius: 16px;
      padding: 32px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      background: rgba(2, 6, 23, 0.4);
    }

    .file-zone:hover, .file-zone.drag-over {
      border-color: var(--fire-orange);
      background: rgba(255, 138, 61, 0.05);
      transform: translateY(-2px);
    }

    .file-zone input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
    }

    .file-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 138, 61, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      color: var(--fire-orange);
      transition: transform 0.3s;
    }

    .file-zone:hover .file-icon {
      transform: scale(1.1);
    }

    .file-text { color: var(--muted); font-size: 0.95rem; margin-bottom: 4px; }
    .file-hint { color: var(--muted); opacity: 0.6; font-size: 0.8rem; }

    /* Scan Button */
    .scan-btn {
      width: 100%;
      margin-top: 24px;
      padding: 16px;
      border-radius: 14px;
      border: none;
      background: linear-gradient(135deg, var(--fire-red), var(--fire-orange));
      color: #fff;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .scan-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 20px 40px -10px rgba(255, 77, 77, 0.5);
    }

    .scan-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .scan-btn.scanning {
      animation: pulse-btn 2s infinite;
    }

    @keyframes pulse-btn {
      0% { box-shadow: 0 0 0 0 rgba(255, 138, 61, 0.7); }
      70% { box-shadow: 0 0 0 20px rgba(255, 138, 61, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 138, 61, 0); }
    }

    /* Results Section */
    .result {
      margin-top: 32px;
      animation: fadeUp 0.6s ease;
    }

    .hidden { display: none !important; }

    .risk-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .risk-score-display {
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .risk-score-number {
      font-size: 4rem;
      font-weight: 800;
      line-height: 1;
      background: linear-gradient(to bottom, #fff, var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .risk-score-total {
      font-size: 1.5rem;
      color: var(--muted);
      font-weight: 600;
    }

    .risk-badge {
      padding: 10px 24px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes popIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .badge-safe { background: rgba(34, 197, 94, 0.15); color: var(--safe); border: 1px solid rgba(34, 197, 94, 0.3); }
    .badge-medium { background: rgba(245, 158, 11, 0.15); color: var(--medium); border: 1px solid rgba(245, 158, 11, 0.3); }
    .badge-high { background: rgba(239, 68, 68, 0.15); color: var(--high); border: 1px solid rgba(239, 68, 68, 0.3); }
    .badge-critical { background: rgba(220, 38, 38, 0.2); color: var(--critical); border: 1px solid rgba(220, 38, 38, 0.4); }

    /* Risk Summary Groups */
    .risk-summary-card {
      background: rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .summary-title {
      color: var(--fire-orange);
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .risk-group {
      margin-bottom: 16px;
      padding-left: 12px;
      border-left: 3px solid;
      animation: slideIn 0.4s ease forwards;
      opacity: 0;
      transform: translateX(-10px);
    }

    .risk-group.critical { border-color: var(--critical); }
    .risk-group.high { border-color: var(--high); }
    .risk-group.medium { border-color: var(--medium); }
    .risk-group.safe { border-color: var(--safe); }

    .risk-group-title {
      font-weight: 700;
      font-size: 0.95rem;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .risk-group.critical .risk-group-title { color: var(--critical); }
    .risk-group.high .risk-group-title { color: var(--high); }
    .risk-group.medium .risk-group-title { color: var(--medium); }

    .risk-group ul {
      list-style: none;
      padding-left: 16px;
    }

    .risk-group li {
      color: var(--muted);
      font-size: 0.9rem;
      padding: 4px 0;
      position: relative;
    }

    .risk-group li::before {
      content: "â€¢";
      position: absolute;
      left: -12px;
      color: currentColor;
    }

    /* Warning Cards */
    .warning-card {
      background: rgba(2, 6, 23, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-left: 4px solid var(--fire-red);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      animation: slideIn 0.4s ease forwards;
      opacity: 0;
      transform: translateY(10px);
    }

    .warning-line {
      font-family: "JetBrains Mono", monospace;
      color: var(--fire-orange);
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 8px;
    }

    .warning-code {
      color: var(--text);
      opacity: 0.8;
    }

    .warning-category {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(255, 77, 77, 0.15);
      color: var(--fire-red);
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .warning-desc {
      color: var(--muted);
      line-height: 1.5;
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .warning-desc i {
      color: var(--fire-yellow);
      flex-shrink: 0;
      margin-top: 2px;
    }

    /* Code Preview */
    .preview-section {
      margin-top: 24px;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .preview-title {
      color: var(--fire-orange);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .code-block {
      background: rgba(2, 6, 23, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 24px;
      overflow-x: auto;
      font-family: "JetBrains Mono", monospace;
      font-size: 0.9rem;
      line-height: 1.7;
      max-height: 400px;
      overflow-y: auto;
    }

    .code-line {
      display: block;
      padding: 2px 12px;
      margin: 2px -12px;
      border-radius: 6px;
      position: relative;
      padding-left: 60px;
    }

    .code-line::before {
      content: attr(data-line);
      position: absolute;
      left: 12px;
      color: var(--muted);
      opacity: 0.4;
      width: 40px;
      text-align: right;
      font-size: 0.85rem;
    }

    .code-line.critical {
      background: rgba(220, 38, 38, 0.15);
      color: #fecaca;
      border-left: 3px solid var(--critical);
    }

    .code-line.high {
      background: rgba(245, 158, 11, 0.1);
      color: #fde68a;
      border-left: 3px solid var(--high);
    }

    .code-line.medium {
      background: rgba(255, 193, 7, 0.05);
      color: #fff3cd;
    }

    /* Feature Cards */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin-top: 64px;
      margin-bottom: 40px;
    }

    .feature-card {
      background: rgba(17, 24, 39, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 32px;
      transition: all 0.3s;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 138, 61, 0.2);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
    }

    .feature-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 138, 61, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--fire-orange);
      margin-bottom: 20px;
      font-size: 24px;
    }

    .feature-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: #fff;
    }

    .feature-desc {
      color: var(--muted);
      line-height: 1.6;
      font-size: 0.95rem;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 32px;
      color: var(--muted);
      font-size: 0.9rem;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      margin-top: 40px;
    }

    .footer span { color: var(--fire-orange); font-weight: 500; }

    /* Animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      to { opacity: 1; transform: translateX(0) translateY(0); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.02); border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(255, 138, 61, 0.3); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255, 138, 61, 0.5); }

    /* Loading Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ Auto-detected badge â”€â”€ */
    #detectedBadge {
      display: block;
      color: var(--safe);
      font-size: 0.75rem;
      margin-top: 6px;
      opacity: 1;
      transition: opacity 1s ease;
    }
  </style>
</head>
<body>

  <!-- Ember Container for burning animation -->
  <div id="ember-container"></div>
  
  <div class="bg-glow bg-glow-red"></div>
  <div class="bg-glow bg-glow-orange"></div>

  <main class="app">
    <!-- Header -->
    <header class="header">
      <h1 class="logo">
        <i data-lucide="flame" class="logo-icon" style="width: 40px; height: 40px; fill: currentColor;"></i>
        Phoenix<span>AI</span>Scan
      </h1>
      <p class="tagline">Scan before you burn <span style="font-size: 1.2em;">ðŸ”¥</span></p>
    </header>

    <!-- Input Card -->
    <section class="glass-card">
      <div class="form-grid">
        <!-- Language Select -->
        <div class="field">
          <label class="field-label">
            <i data-lucide="code-2" style="width: 16px; height: 16px;"></i>
            Language
          </label>
          <div class="custom-select">
            <select id="language">
              <option value="python">Python</option>
              <option value="bash">Bash / Shell</option>
              <option value="sql">SQL</option>
              <option value="javascript">JavaScript</option>
            </select>
            <i data-lucide="chevron-down" class="select-arrow" style="width: 16px; height: 16px;"></i>
          </div>
          <!-- Auto-detected badge appears here dynamically -->
        </div>

        <!-- Security Level Meter -->
        <div class="field">
          <label class="field-label">
            <i data-lucide="shield" style="width: 16px; height: 16px;"></i>
            Security Level
          </label>
          <div class="security-meter">
            <div class="meter-bar">
              <div class="meter-fill" id="securityMeter"></div>
            </div>
            <div class="meter-label">
              <span>Analyzing...</span>
              <span class="meter-value" id="meterValue">IDLE</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Code Input -->
      <div class="field">
        <label class="field-label">
          <i data-lucide="terminal" style="width: 16px; height: 16px;"></i>
          Paste AI-generated code
        </label>
        <div class="code-container">
          <textarea id="code" placeholder="Paste your AI-generated code here...

PhoenixAIScan will analyze risks before execution."></textarea>
          <div class="code-actions">
            <button class="icon-btn" onclick="clearCode()" title="Clear">
              <i data-lucide="trash-2" style="width: 18px; height: 18px;"></i>
            </button>
            <button class="icon-btn" onclick="pasteCode()" title="Paste">
              <i data-lucide="clipboard" style="width: 18px; height: 18px;"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- File Upload -->
      <div class="file-zone" id="dropZone">
        <input type="file" id="fileInput" accept=".py,.sh,.sql,.js">
        <div class="file-icon">
          <i data-lucide="upload-cloud" style="width: 24px; height: 24px;"></i>
        </div>
        <div class="file-text">Drop your file here or click to browse</div>
        <div class="file-hint">Supports .py, .sh, .sql, .js</div>
        <div id="fileName" style="display: none; margin-top: 12px; color: var(--fire-orange); font-weight: 500;"></div>
      </div>

      <!-- Scan Button -->
      <button id="scanBtn" class="scan-btn" onclick="scanCode()">
        <i data-lucide="scan-line" style="width: 20px; height: 20px;"></i>
        <span>Scan Code</span>
      </button>
    </section>

    <!-- Results Section -->
    <section id="result" class="result hidden">
      
      <!-- Score Header -->
      <div class="glass-card" style="margin-bottom: 24px;">
        <div class="risk-header">
          <div class="risk-score-display">
            <span class="risk-score-number" id="riskScore">0</span>
            <span class="risk-score-total">/10</span>
          </div>
          <div id="riskBadge" class="risk-badge badge-safe">Safe</div>
        </div>
      </div>

      <!-- Risk Summary (Grouped) -->
      <div id="riskSummaryCard" class="risk-summary-card hidden">
        <div class="summary-title">
          <i data-lucide="brain" style="width: 18px; height: 18px;"></i>
          Risk Summary
        </div>
        <div id="riskSummaryContent"></div>
      </div>

      <!-- Warnings List -->
      <div id="warningsContainer" style="margin-bottom: 24px;"></div>

      <!-- Code Preview -->
      <div id="previewSection" class="preview-section hidden">
        <div class="glass-card">
          <div class="preview-header">
            <div class="preview-title">
              <i data-lucide="file-warning" style="width: 18px; height: 18px;"></i>
              Code Risk Preview
            </div>
            <span style="font-size: 0.85rem; color: var(--muted);">Highlighted lines indicate risks</span>
          </div>
          <pre class="code-block" id="codePreview"></pre>
        </div>
      </div>

    </section>

    <!-- Features -->
    <div class="features">
      <div class="feature-card">
        <div class="feature-icon">âš¡</div>
        <h3 class="feature-title">Lightning Fast</h3>
        <p class="feature-desc">AI-powered analysis in milliseconds. Don't wait to secure your code.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ðŸ§ </div>
        <h3 class="feature-title">AI Detection</h3>
        <p class="feature-desc">Specifically tuned to catch AI-generated code vulnerabilities and exploits.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ðŸ”’</div>
        <h3 class="feature-title">Zero Trust</h3>
        <p class="feature-desc">We don't store your code. Analysis happens securely without logging.</p>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>PhoenixAIScan never runs your code. <span>It only warns you.</span></p>
    </footer>
  </main>

  <script>
    // Initialize Icons
    lucide.createIcons();

    // Create Burning Embers
    function createEmbers() {
      const container = document.getElementById('ember-container');
      const emberCount = 50;
      for (let i = 0; i < emberCount; i++) {
        const ember = document.createElement('div');
        ember.className = 'ember';
        ember.style.left = Math.random() * 100 + '%';
        ember.style.animationDuration = (Math.random() * 10 + 5) + 's';
        ember.style.animationDelay = Math.random() * 5 + 's';
        ember.style.width = (Math.random() * 3 + 2) + 'px';
        ember.style.height = ember.style.width;
        container.appendChild(ember);
      }
    }
    createEmbers();

    // Backend Configuration
    const API_SCAN_CODE = "https://phoenixaiscan-backend.onrender.com/scan";
    const API_SCAN_FILE = "https://phoenixaiscan-backend.onrender.com/scan-file";
    
    let scanInProgress = false;
    let currentScanId = 0;

    // File Drop Zone
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileNameDisplay = document.getElementById('fileName');

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files[0]) handleFile(e.target.files[0]);
    });

    function handleFile(file) {
      fileNameDisplay.textContent = file.name;
      fileNameDisplay.style.display = 'block';
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById('code').value = e.target.result;
        updateMeter(30, 'FILE LOADED');
        // auto-detect language from file content + filename
        previewDetectLanguage(e.target.result, file.name);
      };
      reader.readAsText(file);
    }

    function clearCode() {
      document.getElementById('code').value = '';
      document.getElementById('fileInput').value = '';
      fileNameDisplay.style.display = 'none';
      updateMeter(0, 'IDLE');
      removeDetectedBadge();
    }

    async function pasteCode() {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('code').value = text;
        updateMeter(20, 'READY');
        if (text.trim().length >= 5) previewDetectLanguage(text);
      } catch (err) {
        console.error('Failed to read clipboard');
      }
    }

    function updateMeter(percent, text) {
      document.getElementById('securityMeter').style.width = percent + '%';
      document.getElementById('meterValue').textContent = text;
    }

    // ==============================================
    // AUTO LANGUAGE DETECTION ON PASTE / TYPE
    // ==============================================

    function setupLanguageAutoDetect() {
      const codeEl = document.getElementById("code");
      if (!codeEl) return;

      let debounceTimer;

      // fires when user types
      codeEl.addEventListener("input", () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          const code = codeEl.value.trim();
          if (code.length >= 5) previewDetectLanguage(code);
        }, 500);
      });

      // fires immediately after paste
      codeEl.addEventListener("paste", () => {
        clearTimeout(debounceTimer);
        setTimeout(() => {
          const code = codeEl.value.trim();
          if (code.length >= 5) previewDetectLanguage(code);
        }, 100);
      });
    }

    async function previewDetectLanguage(code) {
      try {
        const res = await fetch(API_SCAN_CODE, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code, language: "auto" })
        });
        if (!res.ok) return;
        const data = await res.json();
        if (data.language && data.language !== "unknown") {
          updateLanguageDropdown(data.language);
        }
      } catch (e) {
        // silent â€” this is a background preview call
      }
    }

    function updateLanguageDropdown(language) {
      const dropdown = document.getElementById("language");
      if (!dropdown) return;

      const valid = ["python", "javascript", "sql", "bash"];
      const lang = language.toLowerCase();
      if (!valid.includes(lang)) return;
      if (dropdown.value === lang) return; // already correct, skip

      dropdown.value = lang;

      // flash green border on dropdown to show it changed
      dropdown.style.transition = "border-color 0.3s, box-shadow 0.3s";
      dropdown.style.borderColor = "#22c55e";
      dropdown.style.boxShadow = "0 0 0 3px rgba(34,197,94,0.2)";
      setTimeout(() => {
        dropdown.style.borderColor = "";
        dropdown.style.boxShadow = "";
      }, 2000);

      // show badge under dropdown
      removeDetectedBadge();
      const badge = document.createElement("small");
      badge.id = "detectedBadge";
      badge.textContent = "âœ… Auto-detected: " + lang;
      dropdown.parentNode.insertBefore(badge, dropdown.nextSibling);

      // fade badge out after 4s
      setTimeout(() => {
        badge.style.opacity = "0";
        setTimeout(() => badge.remove(), 1000);
      }, 4000);
    }

    function removeDetectedBadge() {
      const old = document.getElementById("detectedBadge");
      if (old) old.remove();
    }

    // ==============================================
    // MAIN SCAN
    // ==============================================

    async function scanCode() {
      const codeEl = document.getElementById("code");
      const fileInputEl = document.getElementById("fileInput");
      const scanBtn = document.getElementById("scanBtn");

      if (scanInProgress) return;
      scanInProgress = true;
      currentScanId++;
      const thisScanId = currentScanId;

      const hasCode = codeEl.value.trim().length > 0;
      const hasFile = fileInputEl.files.length > 0;

      if (!hasCode && !hasFile) {
        shake(codeEl);
        scanInProgress = false;
        return;
      }

      scanBtn.classList.add('scanning');
      scanBtn.disabled = true;
      scanBtn.innerHTML = `<div class="spinner"></div><span>Analyzing...</span>`;
      updateMeter(60, 'SCANNING...');

      resetResultUI();
      document.getElementById('result').classList.remove('hidden');

      try {
        let data;
        if (hasFile) {
          data = await scanUploadedFile(fileInputEl.files[0]);
        } else {
          data = await scanPastedCode(codeEl.value);
        }

        if (thisScanId === currentScanId) {
          renderResult(data);
        }

      } catch (err) {
        console.error(err);
        if (thisScanId === currentScanId) {
          showError(err.message || "Scan failed. Please retry.");
        }
      } finally {
        if (thisScanId === currentScanId) {
          scanInProgress = false;
          scanBtn.classList.remove('scanning');
          scanBtn.disabled = false;
          scanBtn.innerHTML = `<i data-lucide="scan-line" style="width: 20px; height: 20px;"></i><span>Scan Code</span>`;
          lucide.createIcons();
        }
      }
    }

    async function scanPastedCode(code) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 60000);

      // use current dropdown value â€” already updated by auto-detect
      const language = document.getElementById('language').value || 'auto';

      try {
        const res = await fetch(API_SCAN_CODE, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code, language }),
          signal: controller.signal
        });
        if (!res.ok) throw new Error("Scan API failed");
        return res.json();
      } catch (err) {
        if (err.name === "AbortError") throw new Error("Backend was sleeping. Please retry.");
        throw err;
      } finally {
        clearTimeout(timeout);
      }
    }

    async function scanUploadedFile(file) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 60000);
      const formData = new FormData();
      formData.append("file", file);

      try {
        const res = await fetch(API_SCAN_FILE, {
          method: "POST",
          body: formData,
          signal: controller.signal
        });
        if (!res.ok) throw new Error("File scan API failed");
        return res.json();
      } catch (err) {
        if (err.name === "AbortError") throw new Error("Backend was sleeping. Please retry.");
        throw err;
      } finally {
        clearTimeout(timeout);
      }
    }

    // ==============================================
    // RENDER RESULT
    // ==============================================

    function renderResult(data) {
      updateMeter(100, 'COMPLETE');
      
      const riskScoreEl = document.getElementById("riskScore");
      const riskBadgeEl = document.getElementById("riskBadge");
      
      animateNumber(riskScoreEl, data.risk_score || 0);
      
      const level = (data.risk_level || 'safe').toLowerCase();
      riskBadgeEl.className = `risk-badge badge-${level}`;
      riskBadgeEl.textContent = data.risk_level || 'SAFE';

      // update dropdown to confirmed language from backend
      if (data.language && data.language !== "unknown") {
        updateLanguageDropdown(data.language);
      }

      renderWarnings(data.warnings || []);
      renderRiskSummary(data.warnings || []);
      
      const codeEl = document.getElementById("code");
      if (codeEl.value.trim()) {
        renderCodePreview(codeEl.value, data.warnings || []);
      }
    }

    function renderWarnings(warnings) {
      const container = document.getElementById("warningsContainer");
      container.innerHTML = "";

      if (!warnings || warnings.length === 0) {
        container.innerHTML = `
          <div class="glass-card" style="text-align: center; padding: 40px; border-left: 4px solid var(--safe);">
            <i data-lucide="shield-check" style="width: 48px; height: 48px; color: var(--safe); margin-bottom: 16px;"></i>
            <h3 style="color: var(--safe); margin-bottom: 8px;">No threats detected</h3>
            <p style="color: var(--muted);">Your code looks safe to execute.</p>
          </div>
        `;
        lucide.createIcons();
        return;
      }

      warnings.forEach((w, i) => {
        const card = document.createElement("div");
        card.className = "warning-card";
        card.style.animationDelay = `${i * 0.1}s`;
        card.innerHTML = `
          <div class="warning-line">
            Line ${w.line}: <span class="warning-code">${escapeHtml(w.code)}</span>
          </div>
          <span class="warning-category">${w.category || 'Warning'}</span>
          <div class="warning-desc">
            <i data-lucide="alert-triangle" style="width: 16px; height: 16px;"></i>
            <span>${w.explanation}</span>
          </div>
        `;
        container.appendChild(card);
      });
      lucide.createIcons();
    }

    function renderRiskSummary(warnings) {
      const card = document.getElementById("riskSummaryCard");
      const content = document.getElementById("riskSummaryContent");
      
      if (!warnings || warnings.length === 0) {
        card.classList.add("hidden");
        return;
      }

      const grouped = {};
      warnings.forEach(w => {
        const risk = (w.risk || 'MEDIUM').toUpperCase();
        const cat = w.category || 'Unknown';
        if (!grouped[risk]) grouped[risk] = {};
        if (!grouped[risk][cat]) grouped[risk][cat] = 0;
        grouped[risk][cat]++;
      });

      content.innerHTML = "";
      const order = ['CRITICAL', 'HIGH', 'MEDIUM', 'LOW'];
      
      order.forEach((level, idx) => {
        if (!grouped[level]) return;
        const cats = grouped[level];
        const total = Object.values(cats).reduce((a,b) => a+b, 0);
        const group = document.createElement("div");
        group.className = `risk-group ${level.toLowerCase()}`;
        group.style.animationDelay = `${idx * 0.1}s`;
        group.innerHTML = `
          <div class="risk-group-title">${level} (${total})</div>
          <ul>
            ${Object.entries(cats).map(([cat, count]) => `<li>${cat} (${count})</li>`).join("")}
          </ul>
        `;
        content.appendChild(group);
      });

      card.classList.remove("hidden");
    }

    function renderCodePreview(code, warnings) {
      const section = document.getElementById("previewSection");
      const preview = document.getElementById("codePreview");
      
      section.classList.remove("hidden");
      preview.innerHTML = "";
      
      const lines = code.split("\n");
      const riskMap = {};
      
      warnings.forEach(w => {
        const lineNum = parseInt(w.line);
        if (lineNum) riskMap[lineNum] = (w.risk || 'medium').toLowerCase();
      });

      lines.forEach((line, idx) => {
        const lineNum = idx + 1;
        const div = document.createElement("div");
        div.className = "code-line";
        if (riskMap[lineNum]) div.classList.add(riskMap[lineNum]);
        div.dataset.line = lineNum;
        div.textContent = line || " ";
        preview.appendChild(div);
      });

      setTimeout(() => {
        const firstRisk = preview.querySelector(".critical, .high");
        if (firstRisk) firstRisk.scrollIntoView({ behavior: "smooth", block: "center" });
      }, 100);
    }

    function showError(msg) {
      document.getElementById("warningsContainer").innerHTML = `
        <div class="warning-card" style="border-left-color: var(--critical);">
          <div class="warning-line" style="color: var(--critical);">
            <i data-lucide="alert-circle" style="width: 16px; height: 16px;"></i>
            Error
          </div>
          <div class="warning-desc">${escapeHtml(msg)}</div>
        </div>
      `;
      lucide.createIcons();
    }

    function resetResultUI() {
      document.getElementById("riskScore").textContent = "0";
      document.getElementById("riskBadge").className = "risk-badge badge-safe";
      document.getElementById("riskBadge").textContent = "SAFE";
      document.getElementById("warningsContainer").innerHTML = "";
      document.getElementById("riskSummaryCard").classList.add("hidden");
      document.getElementById("riskSummaryContent").innerHTML = "";
      document.getElementById("previewSection").classList.add("hidden");
      document.getElementById("codePreview").innerHTML = "";
    }

    function animateNumber(el, target) {
      let n = 0;
      const step = Math.max(1, Math.floor(target / 20));
      const timer = setInterval(() => {
        n += step;
        if (n >= target) { n = target; clearInterval(timer); }
        el.textContent = n;
      }, 30);
    }

    function shake(el) {
      el.style.transform = "translateX(0)";
      el.style.transition = "transform 0.1s";
      let count = 0;
      const int = setInterval(() => {
        el.style.transform = count % 2 === 0 ? "translateX(-8px)" : "translateX(8px)";
        count++;
        if (count > 5) { clearInterval(int); el.style.transform = ""; }
      }, 50);
    }

    function escapeHtml(text) {
      if (!text) return "";
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;");
    }

    // ==============================================
    // INIT
    // ==============================================
    document.addEventListener("DOMContentLoaded", () => {
      setupLanguageAutoDetect();
    });

  </script>
</body>
</html>